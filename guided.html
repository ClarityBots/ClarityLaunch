<!-- File: guided.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Clarity Launch – Guided SMART Rock Builder</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1>SMART Rock Builder – Guided Mode</h1>

    <label for="userRole">Your role</label>
    <select id="userRole">
      <option value="">-- Select --</option>
      <option value="Visionary">Visionary</option>
      <option value="Integrator">Integrator</option>
      <option value="EOS Implementer">EOS Implementer®</option>
      <option value="Leadership Team Member">Leadership Team Member</option>
    </select>

    <form id="guidedForm">
      <label for="specific">1. Specific: What exactly do you want to accomplish?</label>
      <textarea id="specific" required></textarea>

      <label for="measurable">2. Measurable: How will you track success?</label>
      <textarea id="measurable" required></textarea>

      <label for="achievable">3. Achievable: Why is this realistic and doable?</label>
      <textarea id="achievable" required></textarea>

      <label for="relevant">4. Relevant: Why does this matter to your business/life?</label>
      <textarea id="relevant" required></textarea>

      <label for="timebound">5. Time-bound: What is your deadline?</label>
      <textarea id="timebound" required></textarea>

      <div class="checkbox-group">
        <label><input type="checkbox" id="aiModeToggle" /> Use Enhanced AI</label><br />
        <label><input type="checkbox" id="includeMilestones" /> Include Milestones</label>
      </div>

      <button type="submit">Generate SMART Rock</button>
    </form>

    <h2>Your SMART Rock</h2>
    <div id="outputBox" class="output-box"></div>

    <button id="startOverBtn">Start Over</button>

    <div class="toggle-group">
      <label>
        <input type="checkbox" id="modeToggle" />
        <span>Classic | Guided</span>
      </label>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("guidedForm");
      const outputBox = document.getElementById("outputBox");
      const aiToggle = document.getElementById("aiModeToggle");
      const milestoneToggle = document.getElementById("includeMilestones");
      const modeToggle = document.getElementById("modeToggle");

      // Enable/disable milestones checkbox based on enhanced AI toggle
      const toggleMilestoneCheckbox = () => {
        milestoneToggle.disabled = !aiToggle.checked;
        if (!aiToggle.checked) milestoneToggle.checked = false;
      };

      aiToggle.addEventListener("change", toggleMilestoneCheckbox);
      toggleMilestoneCheckbox();

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        outputBox.innerHTML = "Thinking...";

        const prompt = `
1. Specific: ${document.getElementById("specific").value}
2. Measurable: ${document.getElementById("measurable").value}
3. Achievable: ${document.getElementById("achievable").value}
4. Relevant: ${document.getElementById("relevant").value}
5. Time-bound: ${document.getElementById("timebound").value}
        `.trim();

        try {
          const response = await fetch("/.netlify/functions/coach_smart_rocks", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              prompt,
              role: document.getElementById("userRole").value,
              aiMode: aiToggle.checked ? "enhanced" : "standard",
              includeMilestones: milestoneToggle.checked
            })
          });

          const data = await response.json();
          outputBox.innerHTML = data.output;
        } catch (err) {
          outputBox.innerHTML = "⚠️ Error generating SMART Rock.";
        }
      });

      document.getElementById("startOverBtn").addEventListener("click", () => {
        form.reset();
        outputBox.innerHTML = "";
        toggleMilestoneCheckbox();
      });

      modeToggle.addEventListener("change", () => {
        window.location.href = "index.html";
      });
    });
  </script>
</body>
</html>
